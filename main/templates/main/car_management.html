{% extends 'base.html' %}
{% load static %}

{% block title %}Управление автопарком - Car Rental{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Боковая панель с общей статистикой -->
        <div class="col-md-3">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Статистика автопарка</h5>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            Всего автомобилей
                            <span class="badge bg-primary rounded-pill">{{ total_cars }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            Активные аренды
                            <span class="badge bg-success rounded-pill">{{ active_rentals }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            Требуют ТО
                            <span class="badge bg-warning rounded-pill">{{ maintenance_cars.count }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Быстрые действия -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Быстрые действия</h5>
                    <div class="d-grid gap-2">
                        <a href="{% url 'main:car_create' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Добавить автомобиль
                        </a>
                        <a href="{% url 'main:car_model_create' %}" class="btn btn-outline-primary">
                            <i class="fas fa-car"></i> Добавить модель
                        </a>
                        <a href="{% url 'main:car_type_create' %}" class="btn btn-outline-primary">
                            <i class="fas fa-tags"></i> Добавить категорию
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Основной контент -->
        <div class="col-md-9">
            <!-- Вкладки для разных разделов -->
            <ul class="nav nav-tabs mb-4" id="managementTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="cars-tab" data-bs-toggle="tab" href="#cars" role="tab">
                        Автомобили
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="models-tab" data-bs-toggle="tab" href="#models" role="tab">
                        Модели
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="types-tab" data-bs-toggle="tab" href="#types" role="tab">
                        Категории
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="maintenance-tab" data-bs-toggle="tab" href="#maintenance" role="tab">
                        Техобслуживание
                    </a>
                </li>
            </ul>

            <div class="tab-content" id="managementTabsContent">
                <!-- Вкладка автомобилей -->
                <div class="tab-pane fade show active" id="cars" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Модель</th>
                                    <th>Номер</th>
                                    <th>Год</th>
                                    <th>Статус</th>
                                    <th>Цена/день</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for car in cars %}
                                <tr>
                                    <td>{{ car.model.name }}</td>
                                    <td>{{ car.license_plate }}</td>
                                    <td>{{ car.year }}</td>
                                    <td>
                                        {% if car.is_available %}
                                        <span class="badge bg-success">Доступен</span>
                                        {% else %}
                                        <span class="badge bg-warning">Занят</span>
                                        {% endif %}
                                    </td>
                                    <td>${{ car.daily_rate }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'main:car_update' car.pk %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'main:car_delete' car.pk %}" class="btn btn-sm btn-outline-danger">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Вкладка моделей -->
                <div class="tab-pane fade" id="models" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Производитель</th>
                                    <th>Категория</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for model in car_models %}
                                <tr>
                                    <td>{{ model.name }}</td>
                                    <td>{{ model.manufacturer }}</td>
                                    <td>{{ model.car_type.name }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'main:car_model_update' model.pk %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Вкладка категорий -->
                <div class="tab-pane fade" id="types" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Описание</th>
                                    <th>Кол-во моделей</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for type in car_types %}
                                <tr>
                                    <td>{{ type.name }}</td>
                                    <td>{{ type.description|truncatewords:10 }}</td>
                                    <td>{{ type.carmodel_set.count }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'main:car_type_update' type.pk %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Вкладка техобслуживания -->
                <div class="tab-pane fade" id="maintenance" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Автомобиль</th>
                                    <th>Номер</th>
                                    <th>Последнее ТО</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for car in maintenance_cars %}
                                <tr>
                                    <td>{{ car.model.name }}</td>
                                    <td>{{ car.license_plate }}</td>
                                    <td>{{ car.last_maintenance|default:"Нет данных" }}</td>
                                    <td>
                                        <span class="badge bg-warning">Требуется ТО</span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-success">
                                            <i class="fas fa-check"></i> Отметить выполнение
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 