{% extends 'base.html' %}
{% load main_extras %}

{% block title %}Statistics - Car Rental{% endblock %}

{% block content %}
<h1>Statistics</h1>

<div class="row">
    <!-- Overview Cards -->
    <div class="col-md-3 mb-4">
        <div class="card bg-primary-card text-white">
            <div class="card-body">
                <h5 class="card-title">Total Rentals</h5>
                <h2 class="card-text">{{ total_rentals }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-success-card text-white">
            <div class="card-body">
                <h5 class="card-title">Total Revenue</h5>
                <h2 class="card-text">${{ total_revenue|floatformat:2 }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-info-card text-white">
            <div class="card-body">
                <h5 class="card-title">Total Cars</h5>
                <h2 class="card-text">{{ total_cars }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-warning-card text-white">
            <div class="card-body">
                <h5 class="card-title">Total Clients</h5>
                <h2 class="card-text">{{ total_clients }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Car Type Popularity Chart -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Car Type Popularity</h5>
                {% if car_type_chart %}
                    <div class="chart-container">
                        <img src="data:image/png;base64,{{ car_type_chart }}" alt="Car Type Popularity Chart" class="img-fluid">
                    </div>
                {% else %}
                    <div class="no-data-message">
                        <p class="text-muted">No data available for car type popularity</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Car Availability Chart -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Car Availability</h5>
                {% if availability_chart %}
                    <div class="chart-container">
                        <img src="data:image/png;base64,{{ availability_chart }}" alt="Car Availability Chart" class="img-fluid">
                    </div>
                {% else %}
                    <div class="no-data-message">
                        <p class="text-muted">No data available for car availability</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Average Statistics -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Average Statistics</h5>
                <div class="stat-item mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="stat-label">Average Rental Duration</span>
                        <span class="stat-value">{{ avg_rental_duration|floatformat:1 }} days</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" style="width: {{ avg_duration_percent|floatformat:1 }}%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="stat-label">Average Rentals per Client</span>
                        <span class="stat-value">{{ avg_client_rentals|floatformat:1 }}</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" style="width: {{ avg_client_rentals_percent|floatformat:1 }}%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Most Popular Car Types -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Most Popular Car Types</h5>
                {% if popular_car_types %}
                    {% for car_type in popular_car_types %}
                        <div class="progress-item mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="car-type-name">{{ car_type.name }}</span>
                                <span class="rental-count">{{ car_type.rental_count }} rentals</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar-custom" role="progressbar" 
                                     style="width: {{ car_type.percentage|floatformat:1 }}%"
                                     aria-valuenow="{{ car_type.rental_count }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="{{ popular_car_types.0.rental_count }}">
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-data-message">
                        <p class="text-muted">No car type data available</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .chart-container {
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        margin: 10px 0;
    }
    
    .chart-container img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .no-data-message {
        text-align: center;
        padding: 40px 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 2px dashed #dee2e6;
    }
    
    .no-data-message p {
        margin: 0;
        font-size: 16px;
    }
    
    .card-title {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 20px;
    }
    
    .card {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: none;
        transition: transform 0.2s ease-in-out;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .list-group-item {
        border: none;
        border-bottom: 1px solid #e9ecef;
        padding: 15px 0;
    }
    
    .list-group-item:last-child {
        border-bottom: none;
    }
    
    .badge {
        font-size: 0.9em;
        padding: 8px 12px;
    }
    
    .bg-primary-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .bg-success-card {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .bg-info-card {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .bg-warning-card {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .progress-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }
    
    .car-type-name {
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
    }
    
    .rental-count {
        font-weight: 600;
        color: #3498db;
        font-size: 14px;
    }
    
    .progress {
        background-color: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        height: 8px;
    }
    
    .progress-bar-custom {
        background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
        border-radius: 4px;
        transition: width 0.6s ease;
        height: 100%;
    }
    
    .progress-bar-custom:hover {
        background: linear-gradient(90deg, #2980b9 0%, #27ae60 100%);
    }
    
    .stat-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #e74c3c;
    }
    
    .stat-label {
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
    }
    
    .stat-value {
        font-weight: 700;
        color: #e74c3c;
        font-size: 16px;
    }
    
    .stat-bar {
        background-color: #e9ecef;
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
    }
    
    .stat-fill {
        background: linear-gradient(90deg, #e74c3c 0%, #f39c12 100%);
        height: 100%;
        border-radius: 3px;
        transition: width 0.8s ease;
    }
    
    .stat-fill:hover {
        background: linear-gradient(90deg, #c0392b 0%, #e67e22 100%);
    }
</style>
{% endblock %}