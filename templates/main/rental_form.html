{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Create Rental - Car Rental{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4">Create Rental</h1>
    
    <div class="card">
        <div class="card-body">
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
            {% endif %}

            <form method="post">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6">
                        {{ form.car|as_crispy_field }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        {{ form.start_date|as_crispy_field }}
                    </div>
                    <div class="col-md-6">
                        {{ form.end_date|as_crispy_field }}
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        {{ form.promo_code|as_crispy_field }}
                        <div id="promoHelp" class="form-text">
                            Enter a valid promo code to get a discount on your rental
                        </div>
                    </div>
                </div>

                {{ form.days }}

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">Create Rental</button>
                    <a href="{% url 'main:car_list' %}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('{{ form.start_date.id_for_label }}');
    const endDateInput = document.getElementById('{{ form.end_date.id_for_label }}');
    const daysInput = document.getElementById('{{ form.days.id_for_label }}');

    function updateDays() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        
        if (startDate && endDate && !isNaN(startDate) && !isNaN(endDate)) {
            const diffTime = Math.abs(endDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            daysInput.value = diffDays;
        }
    }

    startDateInput.addEventListener('change', updateDays);
    endDateInput.addEventListener('change', updateDays);
});
</script>
{% endblock %}
{% endblock %} 